---
title: "Knit notebooks"
output: html_notebook
---

# Setup

```{r message=FALSE}
library(magrittr)
library(tidyverse)
```

```{r}
render_notebook <-
  function(notebook_filename,
           data_level,
           similarity_method,
           Metadata_cell_line,
           Metadata_experiment_condition) {
    notebook_name <- tools::file_path_sans_ext(notebook_filename)
    parameters <- list(
      data_level = data_level,
      similarity_method = similarity_method,
      experiment =
        data.frame(
          Metadata_cell_line = Metadata_cell_line,
          Metadata_experiment_condition = Metadata_experiment_condition
        )
    )
    
    parameters_tag <-
      glue::glue("{Metadata_cell_line}_{Metadata_experiment_condition}_{data_level}_sim_{similarity_method}")
    
    print(parameters)
    
    output_file <-
      glue::glue("knit_notebooks/{notebook_name}_{parameters_tag}.nb.html")
    
    rmarkdown::render(glue::glue("{notebook_name}.Rmd"),
                      params = parameters,
                      output_file = output_file)
    
  }
```

# Whole-plate z-scored

```{r}
data_level <- "normalized_feature_select_outlier_trimmed"
```


```{r echo=FALSE}
render_notebook(
  "1.measure_similarities.Rmd",
  data_level = data_level,
  similarity_method = "pearson",
  Metadata_cell_line = "U2OS",
  Metadata_experiment_condition = "Standard"
)
```


```{r echo=FALSE}
render_notebook(
  "2.collate_similarities.Rmd",
  data_level = data_level,
  similarity_method = "pearson",
  Metadata_cell_line = "U2OS",
  Metadata_experiment_condition = "Standard"
)
```


```{r echo=FALSE}
render_notebook(
  "3.inspect_similarities.Rmd",
  data_level = data_level,
  similarity_method = "pearson",
  Metadata_cell_line = "U2OS",
  Metadata_experiment_condition = "Standard"
)
```

# Spherized

```{r}
data_level <- "spherized"
```


```{r echo=FALSE}
render_notebook(
  "1.measure_similarities.Rmd",
  data_level = data_level,
  similarity_method = "pearson",
  Metadata_cell_line = "U2OS",
  Metadata_experiment_condition = "Standard"
)
```


```{r echo=FALSE}
render_notebook(
  "2.collate_similarities.Rmd",
  data_level = data_level,
  similarity_method = "pearson",
  Metadata_cell_line = "U2OS",
  Metadata_experiment_condition = "Standard"
)
```


```{r echo=FALSE}
render_notebook(
  "3.inspect_similarities.Rmd",
  data_level = data_level,
  similarity_method = "pearson",
  Metadata_cell_line = "U2OS",
  Metadata_experiment_condition = "Standard"
)
```

